{"ast":null,"code":"import { ethers } from 'ethers';\nimport { getProvider, getSigner } from './provider.js';\nimport { ADDRESSES } from './config.js';\nimport ChitFundFactoryAbi from '../abis/ChitFundFactory.json';\nimport ChitGroupAbi from '../abis/ChitGroup.json';\nfunction getContract(address, abi, signerOrProvider) {\n  return new ethers.Contract(address, abi, signerOrProvider);\n}\nexport function getFactory(readonly = true) {\n  const p = readonly ? getProvider() : undefined;\n  const signerOrProvider = readonly ? p : undefined;\n  return getContract(ADDRESSES.ChitFundFactory, ChitFundFactoryAbi, signerOrProvider !== null && signerOrProvider !== void 0 ? signerOrProvider : p);\n}\nexport function getGroup(address, readonly = true) {\n  const provider = getProvider();\n  return getContract(address, ChitGroupAbi, provider);\n}\nexport async function readGroupBasics(address) {\n  const group = getGroup(address, true);\n  const [cfg, currentCycle, phase] = await Promise.all([group.cfg(), group.currentCycle(), group.currentPhase()]);\n  return {\n    cfg,\n    currentCycle: Number(currentCycle),\n    phase: Number(phase)\n  };\n}\nexport async function createGroup(cfg) {\n  const signer = await getSigner();\n  const factory = new ethers.Contract(ADDRESSES.ChitFundFactory, ChitFundFactoryAbi, signer);\n  const tx = await factory.createChitGroup(cfg);\n  const receipt = await tx.wait();\n  const ev = receipt.logs.map(l => {\n    try {\n      return factory.interface.parseLog(l);\n    } catch {\n      return null;\n    }\n  }).find(e => e && e.name === 'GroupCreated');\n  return ev ? ev.args.group : null;\n}\nexport async function listGroups() {\n  const factory = getFactory(true);\n  return await factory.getActiveGroups();\n}\nexport async function joinGroup(groupAddress, valueWei = '0') {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const tx = await group.joinGroup({\n    value: valueWei\n  });\n  return await tx.wait();\n}\nexport function computeCommitHash(amount, saltHex) {\n  return ethers.keccak256(ethers.AbiCoder.defaultAbiCoder().encode(['uint256', 'bytes32'], [amount, saltHex]));\n}\nexport async function commitBid(groupAddress, amount, saltHex) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const hash = computeCommitHash(amount, saltHex);\n  const tx = await group.commitBid(hash);\n  return await tx.wait();\n}\nexport async function revealBid(groupAddress, amount, saltHex) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const tx = await group.revealBid(amount, saltHex);\n  return await tx.wait();\n}\nexport async function contribute(groupAddress, amountWei, isNative = true) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const overrides = isNative ? {\n    value: amountWei\n  } : {};\n  const tx = await group.makeContribution(amountWei, overrides);\n  return await tx.wait();\n}\nexport async function openCycle(groupAddress, cycle) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const tx = await group.openCycle(cycle);\n  return await tx.wait();\n}\nexport async function finalizeBidding(groupAddress) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const tx = await group.finalizeBidding();\n  return await tx.wait();\n}\nexport async function distributeFunds(groupAddress) {\n  const signer = await getSigner();\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\n  const tx = await group.distributeFunds();\n  return await tx.wait();\n}","map":{"version":3,"names":["ethers","getProvider","getSigner","ADDRESSES","ChitFundFactoryAbi","ChitGroupAbi","getContract","address","abi","signerOrProvider","Contract","getFactory","readonly","p","undefined","ChitFundFactory","getGroup","provider","readGroupBasics","group","cfg","currentCycle","phase","Promise","all","currentPhase","Number","createGroup","signer","factory","tx","createChitGroup","receipt","wait","ev","logs","map","l","interface","parseLog","find","e","name","args","listGroups","getActiveGroups","joinGroup","groupAddress","valueWei","value","computeCommitHash","amount","saltHex","keccak256","AbiCoder","defaultAbiCoder","encode","commitBid","hash","revealBid","contribute","amountWei","isNative","overrides","makeContribution","openCycle","cycle","finalizeBidding","distributeFunds"],"sources":["C:/Users/kjalf/Downloads/ChitFund_SHM-main/ChitFund_SHM-main/src/web3/contracts.js"],"sourcesContent":["import { ethers } from 'ethers';\r\nimport { getProvider, getSigner } from './provider.js';\r\nimport { ADDRESSES } from './config.js';\r\nimport ChitFundFactoryAbi from '../abis/ChitFundFactory.json';\r\nimport ChitGroupAbi from '../abis/ChitGroup.json';\r\n\r\nfunction getContract(address, abi, signerOrProvider) {\r\n  return new ethers.Contract(address, abi, signerOrProvider);\r\n}\r\n\r\nexport function getFactory(readonly = true) {\r\n  const p = readonly ? getProvider() : undefined;\r\n  const signerOrProvider = readonly ? p : undefined;\r\n  return getContract(ADDRESSES.ChitFundFactory, ChitFundFactoryAbi, signerOrProvider ?? p);\r\n}\r\n\r\nexport function getGroup(address, readonly = true) {\r\n  const provider = getProvider();\r\n  return getContract(address, ChitGroupAbi, provider);\r\n}\r\n\r\nexport async function readGroupBasics(address) {\r\n  const group = getGroup(address, true);\r\n  const [cfg, currentCycle, phase] = await Promise.all([\r\n    group.cfg(),\r\n    group.currentCycle(),\r\n    group.currentPhase(),\r\n  ]);\r\n  return { cfg, currentCycle: Number(currentCycle), phase: Number(phase) };\r\n}\r\n\r\nexport async function createGroup(cfg) {\r\n  const signer = await getSigner();\r\n  const factory = new ethers.Contract(ADDRESSES.ChitFundFactory, ChitFundFactoryAbi, signer);\r\n  const tx = await factory.createChitGroup(cfg);\r\n  const receipt = await tx.wait();\r\n  const ev = receipt.logs\r\n    .map(l => {\r\n      try { return factory.interface.parseLog(l); } catch { return null; }\r\n    })\r\n    .find(e => e && e.name === 'GroupCreated');\r\n  return ev ? ev.args.group : null;\r\n}\r\n\r\nexport async function listGroups() {\r\n  const factory = getFactory(true);\r\n  return await factory.getActiveGroups();\r\n}\r\n\r\nexport async function joinGroup(groupAddress, valueWei = '0') {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const tx = await group.joinGroup({ value: valueWei });\r\n  return await tx.wait();\r\n}\r\n\r\nexport function computeCommitHash(amount, saltHex) {\r\n  return ethers.keccak256(ethers.AbiCoder.defaultAbiCoder().encode(['uint256','bytes32'], [amount, saltHex]));\r\n}\r\n\r\nexport async function commitBid(groupAddress, amount, saltHex) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const hash = computeCommitHash(amount, saltHex);\r\n  const tx = await group.commitBid(hash);\r\n  return await tx.wait();\r\n}\r\n\r\nexport async function revealBid(groupAddress, amount, saltHex) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const tx = await group.revealBid(amount, saltHex);\r\n  return await tx.wait();\r\n}\r\n\r\nexport async function contribute(groupAddress, amountWei, isNative = true) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const overrides = isNative ? { value: amountWei } : {};\r\n  const tx = await group.makeContribution(amountWei, overrides);\r\n  return await tx.wait();\r\n}\r\n\r\nexport async function openCycle(groupAddress, cycle) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const tx = await group.openCycle(cycle);\r\n  return await tx.wait();\r\n}\r\n\r\nexport async function finalizeBidding(groupAddress) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const tx = await group.finalizeBidding();\r\n  return await tx.wait();\r\n}\r\n\r\nexport async function distributeFunds(groupAddress) {\r\n  const signer = await getSigner();\r\n  const group = new ethers.Contract(groupAddress, ChitGroupAbi, signer);\r\n  const tx = await group.distributeFunds();\r\n  return await tx.wait();\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}